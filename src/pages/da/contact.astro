---
import Layout from '../../layouts/Layout.astro';
import { t } from '../../i18n/index.ts';
import IconPhone from '../../components/icons/IconPhone.astro';
import IconLinkedIn from '../../components/icons/IconLinkedIn.astro';
import IconLocation from '../../components/icons/IconLocation.astro';
import IconArrowRight from '../../components/icons/IconArrowRight.astro';

const lang = 'da';  // Hardcode for Danish pages
const prefix = '/da';  // Hardcode for Danish pages
---

<Layout title={t('meta.contactTitle', lang)} description={t('meta.contactDescription', lang)} lang={lang}>
  <section class="page-header">
    <div class="container">
      <span class="page-subtitle">{t('contact.tagline', lang)}</span>
      <h1>{t('contact.title', lang)} <span class="text-gradient">{t('contact.amazing', lang)}</span></h1>
    </div>
  </section>

  <section class="section section-mesh">
    <div class="container">
      <div class="contact-grid">
        <div class="contact-info reveal-left">
          <p style="font-size: 1.1rem;">{t('contact.subtitle', lang)}</p>

          <div class="contact-item">
            <div class="contact-icon">
              <IconPhone />
            </div>
            <div>
              <strong>{t('contact.phone', lang)}</strong><br />
              <a href="tel:+4550587900">+45 50 58 79 00</a>
            </div>
          </div>

          <div class="contact-item">
            <div class="contact-icon">
              <IconLinkedIn />
            </div>
            <div>
              <strong>LinkedIn</strong><br />
              <a href="https://www.linkedin.com/in/kennethabueg/" target="_blank" rel="noopener">
                {t('contact.connectLinkedIn', lang)}
              </a>
            </div>
          </div>

          <div class="contact-item">
            <div class="contact-icon">
              <IconLocation />
            </div>
            <div>
              <strong>{t('contact.businessReg', lang)}</strong><br />
              CVR: DK39733730<br />
              {t('footer.denmark', lang)}
            </div>
          </div>

          <!-- Additional Info Cards -->
          <div class="info-cards">
            <div class="info-card">
              <h4>{t('contact.responseTime', lang)}</h4>
              <p>{t('contact.responseTimeDesc', lang)}</p>
            </div>
            <div class="info-card">
              <h4>{t('contact.freeConsultation', lang)}</h4>
              <p>{t('contact.freeConsultationDesc', lang)}</p>
            </div>
          </div>
        </div>

        <div class="reveal-right">
          <form class="contact-form" id="contact-form"
            data-sending={t('contact.sending', lang)}
            data-success-title={t('contact.successTitle', lang)}
            data-success-msg={t('contact.successMessage', lang)}
            data-error-title={t('contact.errorTitle', lang)}
            data-error-msg={t('contact.errorMessage', lang)}
          >
            <div class="form-group">
              <label class="form-label" for="contact-name">{t('contact.name', lang)} *</label>
              <input type="text" id="contact-name" name="name" class="form-input" required />
            </div>

            <div class="form-group">
              <label class="form-label" for="contact-email">E-mail *</label>
              <input type="email" id="contact-email" name="email" class="form-input" required />
            </div>

            <div class="form-group">
              <label class="form-label" for="contact-phone">{t('contact.phone', lang)}</label>
              <input type="tel" id="contact-phone" name="phone" class="form-input" />
            </div>

            <div class="form-group">
              <label class="form-label" for="contact-service">{t('contact.serviceInterest', lang)}</label>
              <select id="contact-service" name="service" class="form-input form-select">
                <option value="">{t('contact.selectService', lang)}</option>
                <option value="vibecoding">Vibecoding</option>
                <option value="ai-consulting">{t('services.aiConsulting', lang)}</option>
                <option value="workshops">AI-workshops</option>
                <option value="seo">SEO</option>
                <option value="google-ads">Google Ads</option>
                <option value="meta-ads">{t('nav.metaAds', lang)}</option>
                <option value="webdesign">{t('nav.webdesign', lang)}</option>
                <option value="gtm">Google Tag Manager</option>
                <option value="other">{t('contact.other', lang)}</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="contact-message">{t('contact.message', lang)} *</label>
              <textarea id="contact-message" name="message" class="form-textarea" required placeholder={t('contact.messagePlaceholder', lang)}></textarea>
            </div>

            <!-- Honeypot anti-bot field â€” hidden from humans -->
            <div aria-hidden="true" style="position: absolute; left: -9999px; opacity: 0; height: 0; overflow: hidden;">
              <label for="website">Website</label>
              <input type="text" id="website" name="website" tabindex="-1" autocomplete="off" />
            </div>
            <input type="hidden" name="_t" id="form-timestamp" />

            <button type="submit" class="btn btn-primary w-full">
              <span class="btn-text">{t('contact.send', lang)}<IconArrowRight /></span>
            </button>

            <div id="form-status" class="form-status" style="display: none;"></div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <!-- Additional Information Section -->
  <section class="section section-gradient section-grid">
    <div class="container">
      <div class="additional-info-grid reveal">
        <div class="additional-info-item">
          <h4>{t('contact.workingWith', lang)}</h4>
          <p>{t('contact.workingWithDesc', lang)}</p>
        </div>
        <div class="additional-info-item">
          <h4>{t('contact.preferredContact', lang)}</h4>
          <p>{t('contact.preferredContactDesc', lang)}</p>
        </div>
        <div class="additional-info-item">
          <h4>{t('contact.globalReach', lang)}</h4>
          <p>{t('contact.globalReachDesc', lang)}</p>
        </div>
      </div>
    </div>
  </section>
</Layout>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const statusEl = document.getElementById('form-status') as HTMLDivElement;
  const timestampEl = document.getElementById('form-timestamp') as HTMLInputElement;

  if (timestampEl) timestampEl.value = String(Date.now());

  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const submitBtn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
      const btnText = submitBtn.querySelector('.btn-text') as HTMLSpanElement;
      const originalHtml = btnText.innerHTML;
      submitBtn.disabled = true;
      btnText.textContent = form.dataset.sending || 'Sender...';
      statusEl.style.display = 'none';

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      try {
        const res = await fetch('/api/contact', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });

        if (res.ok) {
          statusEl.className = 'form-status form-status-success';
          statusEl.innerHTML = `<strong>${form.dataset.successTitle}</strong><p>${form.dataset.successMsg}</p>`;
          statusEl.style.display = 'block';
          form.reset();
          if (timestampEl) timestampEl.value = String(Date.now());
        } else {
          throw new Error('Request failed');
        }
      } catch {
        statusEl.className = 'form-status form-status-error';
        statusEl.innerHTML = `<strong>${form.dataset.errorTitle}</strong><p>${form.dataset.errorMsg}</p>`;
        statusEl.style.display = 'block';
      } finally {
        submitBtn.disabled = false;
        btnText.innerHTML = originalHtml;
      }
    });
  }
</script>

<style>
.info-cards {
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
  margin-top: var(--space-lg);
}

.info-card {
  background: var(--bg-card);
  padding: var(--space-md);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-subtle);
}

.info-card h4 {
  margin-bottom: var(--space-xs);
  color: var(--text-primary);
  font-size: 1rem;
}

.info-card p {
  color: var(--text-secondary);
  font-size: 0.9rem;
  line-height: 1.5;
}

.additional-info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--space-lg);
}

.additional-info-item {
  text-align: center;
  padding: var(--space-lg);
}

.additional-info-item h4 {
  margin-bottom: var(--space-sm);
  color: var(--text-primary);
}

.additional-info-item p {
  color: var(--text-secondary);
  line-height: 1.6;
}

.form-status {
  margin-top: var(--space-md);
  padding: var(--space-md);
  border-radius: var(--radius-md);
  animation: fadeInStatus 0.3s ease;
}

.form-status-success {
  background: rgba(34, 197, 94, 0.1);
  border: 1px solid rgba(34, 197, 94, 0.3);
  color: rgb(34, 197, 94);
}

.form-status-error {
  background: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.3);
  color: rgb(239, 68, 68);
}

.form-status strong {
  display: block;
  margin-bottom: var(--space-xs);
}

.form-status p {
  margin: 0;
  font-size: 0.9rem;
  line-height: 1.5;
}

@keyframes fadeInStatus {
  from { opacity: 0; transform: translateY(-8px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
